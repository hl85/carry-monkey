# æ¬è¿çŒ´(CarryMonkey)

[![CI](https://github.com/wanghui10/carry-monkey/actions/workflows/main.yml/badge.svg)](https://github.com/wanghui10/carry-monkey/actions/workflows/main.yml)
[![Release](https://github.com/wanghui10/carry-monkey/actions/workflows/release.yml/badge.svg)](https://github.com/wanghui10/carry-monkey/actions/workflows/release.yml)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](./LICENSE)

ç°ä»£åŒ–çš„ç”¨æˆ·è„šæœ¬ç®¡ç†å™¨ Chrome æ‰©å±•ï¼Œæ”¯æŒå®Œå…¨çš„ Manifest V3 åˆè§„æ€§ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### åŒæ¨¡å¼æ¶æ„

- **å•†åº—ç‰ˆ** (`pnpm builds`): å®Œå…¨ç¬¦åˆ Chrome Web Store è§„èŒƒ
- **å…¼å®¹ç‰ˆ** (`pnpm buildc`): åŒ…å«æœ€å¤§å…¼å®¹æ€§åŠŸèƒ½

### MV3 åˆè§„é€‚é…

- âœ… æ—  `eval()` ä½¿ç”¨ï¼ˆå•†åº—æ¨¡å¼ï¼‰
- âœ… æ—  `Function` æ„é€ å™¨ï¼ˆå•†åº—æ¨¡å¼ï¼‰
- âœ… æ”¯æŒ CSP nonce å’Œ Trusted Types
- âœ… å®Œå…¨é™æ€çš„ä»£ç æ‰§è¡Œ
- âœ… UserScripts API åŸç”Ÿæ”¯æŒ

### æ³¨å…¥ç³»ç»Ÿ

- **è‡ªåŠ¨è„šæœ¬éªŒè¯**: æ£€æµ‹å¹¶é˜»æ­¢éåˆè§„ä»£ç 
- **å¤šç­–ç•¥é™çº§**: åˆè§„ â†’ å…¼å®¹ â†’ ä¼ ç»Ÿæ³¨å…¥
- **èµ„æºé¢„åŠ è½½**: è„šæœ¬ä¾èµ–å’Œèµ„æºç¼“å­˜ä¼˜åŒ–
- **ç»Ÿä¸€ API ç®¡ç†**: é›†ä¸­å¤„ç†æ‰€æœ‰ GM\_\* API è°ƒç”¨

### ç”¨æˆ·ä½“éªŒ

- **å¿«æ·é”®æ”¯æŒ**: æ”¯æŒæ–°å»ºã€ä¿å­˜ç­‰å¸¸ç”¨æ“ä½œ (å…¼å®¹ Mac/Win)
- **è½»é‡çº§æç¤º**: è‡ªåŠ¨æ¶ˆå¤±çš„ã€æ— å¹²æ‰°çš„ç”¨æˆ·æç¤ºç³»ç»Ÿ

### æŠ€æœ¯æ ˆ

- **TypeScript**: å®Œæ•´çš„ç±»å‹å®‰å…¨
- **React 18**: æˆç†Ÿçš„ç”¨æˆ·ç•Œé¢æ¡†æ¶
- **Vite**: ç°ä»£åŒ–æ„å»ºå·¥å…·
- **Ant Design**: ä¸“ä¸šçš„ UI ç»„ä»¶åº“
- **ESLint + Prettier**: ä»£ç è´¨é‡ä¿è¯

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- [Node.js](https://nodejs.org/) v18+
- [pnpm](https://pnpm.io/) (æ¨èåŒ…ç®¡ç†å™¨)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**

   ```bash
   git clone https://github.com/hl85/carrymonkey.git
   cd carrymonkey
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   pnpm install
   ```

3. **æ„å»ºæ‰©å±•**

   ```bash
   # å•†åº—ç‰ˆï¼ˆæ¨èï¼‰
   pnpm builds

   # å…¼å®¹ç‰ˆ
   pnpm buildc

   # åŒæ—¶æ„å»ºä¸¤ä¸ªç‰ˆæœ¬
   pnpm build:both
   ```

### åŠ è½½åˆ°æµè§ˆå™¨

1. æ‰“å¼€ Chromeï¼Œè®¿é—® `chrome://extensions`
2. å¯ç”¨å³ä¸Šè§’çš„ **å¼€å‘è€…æ¨¡å¼**
3. ç‚¹å‡» **åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº**
4. é€‰æ‹© `dist/`ï¼ˆå•†åº—ç‰ˆï¼‰æˆ– `dist-compat/`ï¼ˆå…¼å®¹ç‰ˆï¼‰æ–‡ä»¶å¤¹

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### å¼€å‘æ¨¡å¼

```bash
# å•†åº—ç‰ˆå¼€å‘
pnpm dev

# å…¼å®¹ç‰ˆå¼€å‘
pnpm dev:compat
```

### æ„å»ºå‘½ä»¤

```bash
# å•†åº—ç‰ˆæ„å»º
pnpm builds

# å…¼å®¹ç‰ˆæ„å»º
pnpm buildc

# ä»£ç æ£€æŸ¥
pnpm check

# ä»£ç æ ¼å¼åŒ–
pnpm format
```

## ï¿½ ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§           | å•†åº—ç‰ˆ                   | å…¼å®¹ç‰ˆ                |
| -------------- | ------------------------ | --------------------- |
| **åˆè§„æ€§**     | âœ… Chrome Web Store åˆè§„ | âŒ ä¸é€‚åˆå•†åº—æäº¤     |
| **API æ”¯æŒ**   | âœ… UserScripts API åŸç”Ÿ  | âœ… å®Œæ•´ GM API æ”¯æŒ   |
| **ä»£ç æ‰§è¡Œ**   | âŒ æ— åŠ¨æ€ä»£ç æ‰§è¡Œ        | âœ… æ”¯æŒ eval/Function |
| **CSP å…¼å®¹**   | âš ï¸ æœ‰é™æ”¯æŒ              | âœ… å®Œæ•´ç»•è¿‡èƒ½åŠ›       |
| **æµè§ˆå™¨å…¼å®¹** | Chrome 120+              | Chrome 88+            |
| **å®‰å…¨æ€§**     | ğŸ›¡ï¸ æœ€é«˜                  | âš ï¸ ä¸­ç­‰               |
| **æ¨èç”¨é€”**   | å•†åº—å‘å¸ƒã€ä¼ä¸šç¯å¢ƒ       | å¼€å‘æµ‹è¯•ã€é«˜çº§ç”¨æˆ·    |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ core/                      # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ background.ts         # Service Worker åå°è„šæœ¬
â”‚   â”œâ”€â”€ storage.ts            # æ•°æ®å­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ globals.d.ts          # å…¨å±€ç±»å‹å£°æ˜
â”‚
â”œâ”€â”€ ui/                       # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”‚   â”œâ”€â”€ popup/                # æ‰©å±•å¼¹å‡ºçª—å£
â”‚   â”œâ”€â”€ dashboard/            # ç®¡ç†é¢æ¿
â”‚   â””â”€â”€ components/           # å¯å¤ç”¨ UI ç»„ä»¶
â”‚       â””â”€â”€ user-tip.ts       # ç”¨æˆ·æç¤ºç»„ä»¶
â”‚
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ injection/            # è„šæœ¬æ³¨å…¥ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ engine.ts        # ç»Ÿä¸€æ³¨å…¥å¼•æ“
â”‚   â”‚   â”œâ”€â”€ compliant.ts     # åˆè§„æ³¨å…¥ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ legacy.ts        # å…¼å®¹æ³¨å…¥ç­–ç•¥
â”‚   â”‚   â””â”€â”€ utils.ts         # æ³¨å…¥å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ gm-api-manager.ts     # GM API ç®¡ç†å™¨
â”‚   â”œâ”€â”€ script-resource-manager.ts # è„šæœ¬èµ„æºç®¡ç†
â”‚   â”œâ”€â”€ userscripts-api.ts    # UserScripts API åŒ…è£…
â”‚   â””â”€â”€ user-notifier.ts      # è½»é‡çº§ç”¨æˆ·é€šçŸ¥æœåŠ¡
â”‚
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ feature-flags.ts      # åŠŸèƒ½å¼€å…³é…ç½®
â”‚   â””â”€â”€ build-modes.ts        # æ„å»ºæ¨¡å¼é…ç½®
â”‚
â”œâ”€â”€ manifest/                 # æ‰©å±•æ¸…å•é…ç½®
â”‚   â”œâ”€â”€ base.ts              # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ store.ts             # å•†åº—ç‰ˆé…ç½®
â”‚   â”œâ”€â”€ compat.ts            # å…¼å®¹ç‰ˆé…ç½®
â”‚   â””â”€â”€ index.ts             # åŠ¨æ€é…ç½®é€‰æ‹©
â”‚
â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
    â””â”€â”€ matcher.ts            # URL åŒ¹é…å·¥å…·
```

### æ¶æ„è®¾è®¡åŸåˆ™

1. **åˆ†å±‚æ¶æ„**: Core â†’ Services â†’ UI â†’ Config
2. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®ï¼Œä½è€¦åˆé«˜å†…èš
3. **é…ç½®é©±åŠ¨**: é€šè¿‡åŠŸèƒ½æ ‡å¿—æ§åˆ¶ä¸åŒæ„å»ºæ¨¡å¼çš„è¡Œä¸º
4. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### ğŸª å•†åº—ç‰ˆé€‚ç”¨åœºæ™¯

- Chrome Web Store å‘å¸ƒ
- ä¼ä¸šç¯å¢ƒéƒ¨ç½²
- å®‰å…¨è¦æ±‚è¾ƒé«˜çš„åœºæ™¯
- éœ€è¦é•¿æœŸç»´æŠ¤çš„é¡¹ç›®

### ğŸ”§ å…¼å®¹ç‰ˆé€‚ç”¨åœºæ™¯

- å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- éœ€è¦æœ€å¤§å…¼å®¹æ€§çš„åœºæ™¯
- é«˜çº§ç”¨æˆ·è‡ªå®šä¹‰éœ€æ±‚
- ä¼ ç»Ÿç”¨æˆ·è„šæœ¬è¿ç§»

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æºä»£ç æ¶æ„è¯´æ˜](./src/README.md) - è¯¦ç»†çš„ä»£ç ç»“æ„æ–‡æ¡£
- [æ³¨å…¥ç­–ç•¥è¯¦è§£](./docs/injection-strategy.md) - è„šæœ¬æ³¨å…¥æœºåˆ¶è¯´æ˜
- [æ„å»ºæ¨¡å¼é…ç½®](./docs/build-modes.md) - æ„å»ºé…ç½®è¯¦è§£
- [å¼€å‘æŒ‡å—](./docs/development.md) - å¼€å‘ç¯å¢ƒæ­å»º

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®åŸºäº [MIT License](./LICENSE) å¼€æºåè®®ã€‚

---

**CarryMonkey** - è®©ç”¨æˆ·è„šæœ¬ç®¡ç†æ›´åŠ ç°ä»£åŒ–ã€å®‰å…¨å’Œé«˜æ•ˆ ğŸ’âœ¨
